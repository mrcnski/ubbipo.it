---
import { Image } from "astro:assets";
import ShootingMain from "@assets/images/index/main.jpeg";
import Index1 from "@assets/images/index/index1.jpg";
import Index2 from "@assets/images/index/index2.jpeg";
import LogoFullWhite from "@assets/images/logo/full-white.svg";

import Layout from "@layouts/Layout.astro";
import FadeIn from "@components/FadeIn.astro";
import PageContainer from "@components/PageContainer.astro";
import PageSection from "@components/PageSection.astro";

import { getLangFromUrl, useTranslations } from '../i18n/utils';
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<Layout title={t("index.title")} description={t("index.description")}>
    <Image class="index-img-main" src={ShootingMain} alt={t("site.name")} />
    <Image class="index-img-logo" src={LogoFullWhite} alt={t("site.name")} />
    <noscript>
        <Image class="index-img-logo-noscript" src={LogoFullWhite} alt={t("site.name")} />
    </noscript>

    <PageContainer>
        <PageSection>
            <FadeIn> <h2 class="index-header">{t("index.1.title")}</h2> </FadeIn>
            <div class="index-staggered">
                <FadeIn classList={["index-item-img"]}>
                    <Image class="index-img" src={Index1} alt={t("index.1.title")} />
                </FadeIn>
                <FadeIn classList={["index-item-description"]}>
                    <p class="index-description">{t("index.1.description")}</p>
                </FadeIn>
            </div>

            <FadeIn> <h2 class="index-header">{t("index.2.title")}</h2> </FadeIn>
            <div class="index-staggered">
                <FadeIn classList={["index-item-img"]}>
                    <Image class="index-img" src={Index2} alt={t("index.2.title")} />
                </FadeIn>
                <FadeIn classList={["index-item-description"]}>
                    <p class="index-description">{t("index.2.description")}</p>
                </FadeIn>
            </div>
            
        </PageSection>

        <PageSection>
            <br>
            <br>
            <FadeIn>
                <slot name="lightwidget" />
            </FadeIn>
        </PageSection>
    </PageContainer>
</Layout>

<style lang="less">
    .index-img-main {
        height: 100vh;
        object-fit: cover;
    }
    .index-img-logo {
        position: absolute;
        
        /* Start the logo with no opacity. We animate it with JS. We also need to position it over the main image. */
        opacity: 0;
        transition: opacity 2s;

        filter: drop-shadow(0px 0px 15px rgba(0, 0, 0, 0.5));
    }
    .index-img-logo-noscript {
        position: absolute;

        width: 40%;
        height: auto;
        left: 30%;
        top: 12%;
        
        filter: drop-shadow(0px 0px 15px rgba(0, 0, 0, 0.5));
    }

    .index-staggered {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        column-gap: 3rem;
        row-gap: 2rem;
        
        @media (max-width: 1400px) {
            flex-direction: column;
        }

        :global(.index-item-img) {
            flex-basis: 60%;
        }
        :global(.index-item-description) {
            flex-basis: 40%;
        }

        img {
            height: auto;
            border-radius: 0.5rem;

            @media (max-width: 1400px) {
                width: 100%;
                max-width: 600px;
            }
        }
        p {
            margin-top: 10rem;

            width: 100%;
            max-width: 30ch;
            text-align: justify;

            font-size: 1.6rem;
            color: var(--brown);

            @media (max-width: 1400px) {
                margin-top: 0;
            }
            @media (max-width: 600px) {
                font-size: 1.2rem;
            }
        }
    }

    .index-header {
        margin-top: 4rem;
        margin-bottom: 3rem;

        text-transform: none;

        @media (max-width: 600px) {
            font-size: 1.5rem;
        }
    }
</style>

<script>
    function setLogoPosition() {
        // Put the logo in the middle of the main image.
        const mainImg = document.querySelector('.index-img-main') as HTMLImageElement;
        const logo = document.querySelector('.index-img-logo') as HTMLImageElement;
        if (!mainImg || !logo) return;

        const mainImgWidth = mainImg.width;
        const mainImgHeight = mainImg.height;

        if (mainImgWidth < 900) {
            logo.style.width = `${mainImgWidth * 0.5}px`;
        }

        const logoWidth = logo.width;
        const logoHeight = logo.height;
        const logoX = mainImgWidth / 2 - logoWidth / 2;
        const logoY = mainImgHeight / 2 - logoHeight / 2 + 32;
        logo.style.left = `${logoX}px`;
        logo.style.top = `${logoY}px`;
        logo.style.opacity = "0.89";
    }

    document.addEventListener('astro:page-load', () => {
        setLogoPosition();
    });

    window.addEventListener('resize', () => {
        setLogoPosition();
    });
</script>