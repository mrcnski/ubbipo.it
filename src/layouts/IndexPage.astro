---
import { Image } from "astro:assets";
import ShootingMain from "@assets/images/index/main.jpeg";
import Index1 from "@assets/images/index/index1.jpeg";
import Index2 from "@assets/images/index/index2.jpeg";
import LogoFullWhite from "@assets/images/logo/full-white.svg";

import Layout from "@layouts/Layout.astro";
import FadeIn from "@components/FadeIn.astro";
import PageContainer from "@components/PageContainer.astro";
import IndexPageSection from "@components/IndexPageSection.astro";

import { getLangFromUrl, useTranslations } from '../i18n/utils';
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<Layout title={t("index.title")} description={t("index.description")}>
    <Image class="index-img-main" src={ShootingMain} alt={t("site.name")} />
    <Image class="index-img-logo" src={LogoFullWhite} alt={t("site.name")} />
    <noscript>
        <Image class="index-img-logo-noscript" src={LogoFullWhite} alt={t("site.name")} />
    </noscript>

    <PageContainer>
        <FadeIn>
        <IndexPageSection sectionTitle={t("index.1.title")}>
                <div class="index-1">
                    <Image class="index-img" src={Index1} alt={t("index.1.title")} />
                    <p class="index-description">{t("index.1.description")}</p>
                </div>
            </IndexPageSection>
        </FadeIn>

        <FadeIn>
                <IndexPageSection sectionTitle={t("index.2.title")}>
                <div class="index-2">
                    <Image class="index-img" src={Index2} alt={t("index.2.title")} />
                    <p class="index-description">{t("index.2.description")}</p>
                </div>
            </IndexPageSection>
        </FadeIn>

        <IndexPageSection sectionTitle="">
            <slot name="lightwidget" />
        </IndexPageSection>
    </PageContainer>
</Layout>

<style lang="less">
    .index-img-main {
        height: 100vh;
        object-fit: cover;
    }
    .index-img-logo {
        position: absolute;
        
        /* Start the logo with no opacity. We animate it with JS. We also need to position it over the main image. */
        opacity: 0;
        transition: opacity 2s;

        filter: drop-shadow(0px 0px 15px rgba(0, 0, 0, 0.5));
    }
    .index-img-logo-noscript {
        position: absolute;

        width: 40%;
        height: auto;
        left: 30%;
        top: 12%;
        
        filter: drop-shadow(0px 0px 15px rgba(0, 0, 0, 0.5));
    }

    .index-1 {
        display: flex;
        flex-direction: row;
        justify-content: space-around;
        align-items: center;
        gap: 1rem;

        img {
            width: 40%;
            height: auto;
            flex-shrink: 0;
        }
    }

    .index-2 {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;

        img {
            width: 60%;
            height: auto;
            flex-shrink: 0;
        }
        p {
            max-width: 60ch;
        }
    }

    .index-description {
        width: 100%;
        max-width: 25ch;
        font-size: 1.4rem;
        color: var(--brown);
    }
    .index-img {
        border-radius: 0.5rem;
    }
</style>

<script>
    function setLogoPosition() {
        // Put the logo in the middle of the main image.
        const mainImg = document.querySelector('.index-img-main') as HTMLImageElement;
        const logo = document.querySelector('.index-img-logo') as HTMLImageElement;
        if (!mainImg || !logo) return;

        const mainImgWidth = mainImg.width;
        const mainImgHeight = mainImg.height;

        if (mainImgWidth < 900) {
            logo.style.width = `${mainImgWidth * 0.5}px`;
        }

        const logoWidth = logo.width;
        const logoHeight = logo.height;
        const logoX = mainImgWidth / 2 - logoWidth / 2;
        const logoY = mainImgHeight / 2 - logoHeight / 2 + 32;
        logo.style.left = `${logoX}px`;
        logo.style.top = `${logoY}px`;
        logo.style.opacity = "0.89";
    }

    document.addEventListener('astro:page-load', () => {
        setLogoPosition();
    });

    window.addEventListener('resize', () => {
        setLogoPosition();
    });
</script>