---
import ShootingMain from "../assets/images/shooting-main.jpg";
import LogoFullWhite from "../assets/images/logo-full-white.svg";
import Layout from "./Layout.astro";
import PageContainer from "../components/PageContainer.astro";
import PageSection from "../components/PageSection.astro";

import { Image } from "astro:assets";

import { getLangFromUrl, useTranslations } from '../i18n/utils';
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<Layout title={t("index.title")} description={t("index.description")}>
    <Image class="index-img-main" src={ShootingMain} alt={t("site.name")} />
    <Image class="index-img-logo" src={LogoFullWhite} alt={t("site.name")} />

    <PageContainer>
        <PageSection sectionTitle="">
            {
                {
                    "it":
                    <!-- LightWidget WIDGET --><script src="https://cdn.lightwidget.com/widgets/lightwidget.js"></script><iframe src="https://cdn.lightwidget.com/widgets/df52b61460185416a0f0995f9c907212.html" scrolling="no" allowtransparency="true" class="lightwidget-widget" style="width:100%;border:0;overflow:hidden;"></iframe>,
                    "en":
                    <!-- LightWidget WIDGET --><script src="https://cdn.lightwidget.com/widgets/lightwidget.js"></script><iframe src="https://cdn.lightwidget.com/widgets/3c6a4b567f2f513e83dbad25217280cc.html" scrolling="no" allowtransparency="true" class="lightwidget-widget" style="width:100%;border:0;overflow:hidden;"></iframe>,
                }[lang]
            }
        </PageSection>
    </PageContainer>
</Layout>

<style>
    .index-img-main {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
    }
    .index-img-logo {
        position: absolute;
        
        /* Start the logo with no opacity. We animate it with JS. We also need to position it over the main image. */
        opacity: 0;
        transition: opacity 2s;

        filter: drop-shadow(0px 0px 15px rgba(0, 0, 0, 0.5));
    }
</style>

<script>
    function setLogoPosition() {
        // Put the logo in the middle of the main image.
        const mainImg = document.querySelector('.index-img-main') as HTMLImageElement;
        const logo = document.querySelector('.index-img-logo') as HTMLImageElement;
        if (!mainImg || !logo) return;

        const mainImgWidth = mainImg.width;
        const mainImgHeight = mainImg.height;

        if (mainImgWidth < 900) {
            logo.style.width = `${mainImgWidth * 0.5}px`;
        }

        const logoWidth = logo.width;
        const logoHeight = logo.height;
        const logoX = mainImgWidth / 2 - logoWidth / 2;
        const logoY = mainImgHeight / 2 - logoHeight / 2 + 32;
        logo.style.left = `${logoX}px`;
        logo.style.top = `${logoY}px`;
        logo.style.opacity = "0.89";
    }
    // Set the logo position when the page loads.
    document.addEventListener('astro:page-load', () => {
        setLogoPosition();
    });
    // Set the logo position when the window resizes.
    window.addEventListener('resize', () => {
        setLogoPosition();
    });
</script>