---
import ShootingMain from "@assets/images/index/main.jpeg";
import LogoFullWhite from "@assets/images/logo/full-white.svg";
import Layout from "@layouts/Layout.astro";
import PageContainer from "@components/PageContainer.astro";
import PageSection from "@components/PageSection.astro";

import { Image } from "astro:assets";

import { getLangFromUrl, useTranslations } from '../i18n/utils';
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<Layout title={t("index.title")} description={t("index.description")}>
    <Image class="index-img-main" src={ShootingMain} alt={t("site.name")} />
    <Image class="index-img-logo" src={LogoFullWhite} alt={t("site.name")} />
    <noscript>
        <Image class="index-img-logo-noscript" src={LogoFullWhite} alt={t("site.name")} />
    </noscript>

    <PageContainer>
        <PageSection sectionTitle="">
            <slot name="lightwidget" />
        </PageSection>
    </PageContainer>
</Layout>

<style lang="less">
    .index-img-main {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
    }
    .index-img-logo {
        position: absolute;
        
        /* Start the logo with no opacity. We animate it with JS. We also need to position it over the main image. */
        opacity: 0;
        transition: opacity 2s;

        filter: drop-shadow(0px 0px 15px rgba(0, 0, 0, 0.5));
    }
    .index-img-logo-noscript {
        position: absolute;

        width: 40%;
        height: auto;
        left: 30%;
        top: 12%;
        /* transform: translateY(-50%); */
        
        filter: drop-shadow(0px 0px 15px rgba(0, 0, 0, 0.5));
    }
</style>

<script>
    function setLogoPosition() {
        // Put the logo in the middle of the main image.
        const mainImg = document.querySelector('.index-img-main') as HTMLImageElement;
        const logo = document.querySelector('.index-img-logo') as HTMLImageElement;
        if (!mainImg || !logo) return;

        const mainImgWidth = mainImg.width;
        const mainImgHeight = mainImg.height;

        if (mainImgWidth < 900) {
            logo.style.width = `${mainImgWidth * 0.5}px`;
        }

        const logoWidth = logo.width;
        const logoHeight = logo.height;
        const logoX = mainImgWidth / 2 - logoWidth / 2;
        const logoY = mainImgHeight / 2 - logoHeight / 2 + 32;
        logo.style.left = `${logoX}px`;
        logo.style.top = `${logoY}px`;
        logo.style.opacity = "0.89";
    }
    // Set the logo position when the page loads.
    document.addEventListener('astro:page-load', () => {
        setLogoPosition();
    });
    // Set the logo position when the window resizes.
    window.addEventListener('resize', () => {
        setLogoPosition();
    });
</script>